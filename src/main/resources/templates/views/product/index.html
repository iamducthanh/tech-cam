<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/weblayout}"
>
<head>
    <meta charset="UTF-8">
    <title>Quản lý sản phẩm - TechCam</title>
    <link rel="stylesheet" th:href="@{/assets/css/select2.min.css}">
</head>
<body>
<div layout:fragment="content" class="container-fluid" style="max-width: 98%">
    <div class="row container1">
        <div class="col-lg-2 h-100" id="leftKH">
            <h1 class="heading-page">Quản lý sản phẩm</h1>
            <div class="filter-report">
                <div class="card" style="padding-left: 15px; padding-top: 15px">
                    <h6 class="mx-2 mt-2 fs-14">Trạng thái</h6>
                    <div class="mx-2 mb-2">
                        <div class="form-group form-check">
                            <input class="form-check-input" type="radio" name="status" id="statusAll" value=""
                                   onchange="onStatusChange(this)" checked>
                            <label class="form-check-label" for="statusAll">
                                Tất cả
                            </label>
                        </div>
                        <div class="form-group form-check">
                            <input class="form-check-input" type="radio" name="status" id="statusActive"
                                   value="Kinh doanh" onchange="onStatusChange(this)">
                            <label class="form-check-label" for="statusActive">
                                Kinh doanh
                            </label>
                        </div>
                        <div class="form-group form-check">
                            <input class="form-check-input" type="radio" name="status" id="statusInActive"
                                   value="Ngừng kinh doanh" onchange="onStatusChange(this)">
                            <label class="form-check-label" for="statusInActive">
                                Ngừng kinh doanh
                            </label>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="col-lg-10" id="rightKH" style="height: 100%">
            <div class="row justify-content-end">
                <a href="#modal-add-product" type="button"
                   class="btn btn-primary col-auto mb-3 waves-effect waves-light"
                   data-bs-toggle="modal">
                    <i class="fas fa-plus me-2"></i>
                    Sản phẩm
                </a>
            </div>
            <div class="card">
                <div class="card-body">
                    <div class="row">
                        <div class="col-lg-12">
                            <div class="card">
                                <div class="card-body overflow-auto">
                                    <table id="datatable"
                                           class="table table-striped table-hover table-bordered nowrap dataTable no-footer shadow"
                                           style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                                        <thead>
                                        <tr class="text-center">
                                            <th>STT</th>
                                            <th>Thumbnail</th>
                                            <th>Chức năng</th>
                                            <th>Tên sản phẩm</th>
                                            <th>Giá bán</th>
                                            <th>Tồn kho</th>
                                            <th>Trạng thái</th>
                                            <th>Người thêm</th>
                                            <th>Ngày thêm</th>
                                            <th>Ngày cập nhật</th>
                                        </tr>
                                        </thead>
                                        <tbody>
                                        <th:block th:each="product, theCount : ${lstProducts}">
                                            <tr>
                                                <td class="text-center" th:text="${theCount.index + 1}">STT</td>
                                                <td class="text-center">
                                                    <img th:src="${product.thumbnail}" th:title="${product.productName}" height="25px"
                                                         style="cursor: pointer" onclick="zoomImageProduct(this)"/>
                                                </td>
                                                <td class="text-center">
                                                    <a href="#modal-edit-product" th:data-id="${product.productId}" data-bs-toggle="modal"
                                                       class="btn btn-primary btn-sm waves-effect waves-light"
                                                       onclick="onClickEditProduct(this)">
                                                        Chỉnh sửa
                                                    </a>
                                                </td>
                                                <td th:text="${product.productName}">Tên sản phẩm</td>
                                                <td class="text-end"
                                                    th:text="${#numbers.formatDecimal(product.productPrice, 0, 'COMMA', 2, 'POINT') + 'đ'}">
                                                    Giá bán
                                                </td>
                                                <td class="text-end">Tồn kho</td>
                                                <td class="text-center">
                            <span th:if="${product.productStatus != null && product.productStatus == 'ON'}"
                                  class="badge bg-success">
                                Kinh doanh
                            </span>
                                                    <span th:unless="${product.productStatus != null && product.productStatus == 'ON'}"
                                                          class="badge bg-danger">
                                Ngừng kinh doanh
                            </span>
                                                </td>
                                                <td th:text="${product.createBy}" class="text-center">Người thêm</td>
                                                <td th:text="${#dates.format(product.createDate, 'dd-MM-yyyy')}" class="text-center">
                                                </td>
                                                <td th:text="${#dates.format(product.modifierDate, 'dd-MM-yyyy')}" class="text-center">
                                                </td>
                                            </tr>
                                        </th:block>
                                        </tbody>
                                    </table>

                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- <div id="morris-bar-stacked" class="morris-chart-height morris-charts"></div> -->
                </div>
            </div>
        </div>
    </div>


    <div id="modal-add-product" class="modal fade show" style="display: block;" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title mt-0">Thêm sản phẩm</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs nav-tabs-custom nav-justified" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="tab" href="#info-product" role="tab">
                                <span class="d-none d-md-block">Thông tin sản phẩm</span><span
                                    class="d-block d-md-none"><i class="mdi mdi-home-variant h5"></i></span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#description-product" role="tab">
                                <span class="d-none d-md-block">Mô tả chi tiết sản phẩm</span><span
                                    class="d-block d-md-none"><i class="mdi mdi-account h5"></i></span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#image-product-add" role="tab">
                                <span class="d-none d-md-block">Hình ảnh sản phẩm</span><span
                                    class="d-block d-md-none"><i class="mdi mdi-account h5"></i></span>
                            </a>
                        </li>
                    </ul>

                    <!-- Tab panes -->
                    <div class="tab-content">
                        <div class="tab-pane active p-3" id="info-product" role="tabpanel">
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="mb-3 row">
                                        <div class="col-lg-5">
                                            Mã sản phẩm
                                        </div>
                                        <div class="col-lg-7">
                                            <input type="text" id="ip-add-product-code" placeholder="Mã sản phẩm...."
                                                   class="form-control"/>
                                        </div>
                                    </div>
                                    <div class="mb-3 row">
                                        <div class="col-lg-5">
                                            Tên sản phẩm
                                        </div>
                                        <div class="col-lg-7">
                                            <input type="text" id="ip-add-product-name" placeholder="Tên sản phẩm...."
                                                   class="form-control"/>
                                        </div>
                                    </div>
                                    <div class="mb-3 row">
                                        <div class="col-lg-5">
                                            Giá bán
                                        </div>
                                        <div class="col-lg-7">
                                            <input type="text" id="ip-add-product-price" placeholder="Giá bán...."
                                                   class="form-control"/>
                                        </div>
                                    </div>
                                    <div class="mb-3 row">
                                        <div class="col-lg-5">
                                            Thương hiệu
                                        </div>
                                        <div class="col-lg-7">
                                            <select id="ip-add-product-brand" class="form-control select2">
                                                <option th:each="brand : ${lstBrands}" th:value="${brand.brandId}"
                                                        th:text="${brand.brandName}">
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mb-3 row">
                                        <div class="col-lg-5"></div>
                                        <div class="col-lg-7">
                                            <input class="form-check-input mt-2" type="checkbox"
                                                   id="ip-add-product-status"/>
                                            <label for="ip-add-product-status" class="col-form-label">
                                                Kinh doanh sản phẩm ngay
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="mb-3 row">
                                        <div class="col-lg-5">
                                            Danh mục sản phẩm
                                        </div>
                                        <div class="col-lg-7">
                                            <select id="ip-add-product-category" class="form-control select2"
                                                    data-status="add" onchange="onChangeCategory(this)">
                                                <option th:each="category : ${lstCategories}"
                                                        th:value="${category.categoryId}"
                                                        th:text="${category.categoryName}">
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                    <div id="product-add-property"></div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane p-3" id="description-product" role="tabpanel">
                            <textarea id="productAddDescription" class="form-control"></textarea>
                        </div>
                        <div class="tab-pane p-3" id="image-product-add" role="tabpanel">
                            <div class="dropzone mb-3 text-center">
                                <div class="fallback">
                                    <input id="ip-add-product-image" hidden type="file" multiple="multiple">
                                </div>
                                <div class="dz-message needsclick mt-5" onclick="onClickChooseImageAdd()">
                                    <div class="mb-3">
                                        <i class="mdi mdi-cloud-upload display-4 text-muted"></i>
                                    </div>
                                    <h4>Nhấn để chọn hình ảnh.</h4>
                                </div>
                            </div>
                            <hr/>
                            <div class="file_upload">
                                <div class="bd-example text-center">
                                    <div id="carouselExampleCaptionsAdd" class="carousel slide" data-bs-ride="carousel">
                                        <div class="carousel-indicators" id="carousel-indicators-add">
                                        </div>
                                        <div class="carousel-inner" id="previewUploadAdd">
                                        </div>
                                        <a class="carousel-control-prev " type="button"
                                           data-bs-target="#carouselExampleCaptionsAdd"
                                           data-bs-slide="prev">
                                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                            <span class="visually-hidden">Previous</span>
                                        </a>
                                        <a class="carousel-control-next" type="button"
                                           data-bs-target="#carouselExampleCaptionsAdd"
                                           data-bs-slide="next">
                                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                            <span class="visually-hidden">Next</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary waves-effect" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" class="btn btn-success waves-effect waves-light"
                            onclick="onClickSaveProduct()">
                        Lưu
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div id="modal-edit-product" class="modal fade show" style="display: block;" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-xl modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title mt-0">Sửa sản phẩm</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <ul class="nav nav-tabs nav-tabs-custom nav-justified" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" data-bs-toggle="tab" href="#info-product-edit" role="tab">
                                <span class="d-none d-md-block">Thông tin sản phẩm</span>
                                <span class="d-block d-md-none">
                                    <i class="mdi mdi-home-variant h5"></i>
                                </span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#description-product-edit" role="tab">
                                <span class="d-none d-md-block">Mô tả chi tiết sản phẩm</span><span
                                    class="d-block d-md-none"><i class="mdi mdi-account h5"></i></span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" data-bs-toggle="tab" href="#image-product-edit" role="tab">
                                <span class="d-none d-md-block">Hình ảnh sản phẩm</span><span
                                    class="d-block d-md-none"><i class="mdi mdi-account h5"></i></span>
                            </a>
                        </li>
                    </ul>

                    <!-- Tab panes -->
                    <div class="tab-content">
                        <div class="tab-pane active p-3" id="info-product-edit" role="tabpanel">
                            <div class="row">
                                <div class="col-lg-6">
                                    <div class="mb-3 row">
                                        <div class="col-lg-5">
                                            Mã sản phẩm
                                        </div>
                                        <div class="col-lg-7">
                                            <input type="text" id="ip-edit-product-code" placeholder="Mã sản phẩm...."
                                                   class="form-control"/>
                                        </div>
                                    </div>
                                    <div class="mb-3 row">
                                        <div class="col-lg-5">
                                            Tên sản phẩm
                                        </div>
                                        <div class="col-lg-7">
                                            <input type="text" id="ip-edit-product-name" placeholder="Tên sản phẩm...."
                                                   class="form-control"/>
                                        </div>
                                    </div>
                                    <div class="mb-3 row">
                                        <div class="col-lg-5">
                                            Giá bán
                                        </div>
                                        <div class="col-lg-7">
                                            <input type="text" id="ip-edit-product-price" placeholder="Giá bán...."
                                                   class="form-control"/>
                                        </div>
                                    </div>
                                    <div class="mb-3 row">
                                        <div class="col-lg-5">
                                            Thương hiệu
                                        </div>
                                        <div class="col-lg-7">
                                            <select id="ip-edit-product-brand"
                                                    class="form-control select2 ip-voucher-person-apply">
                                                <option th:each="brand : ${lstBrands}" th:value="${brand.brandId}"
                                                        th:text="${brand.brandName}">
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                    <div class="mb-3 row">
                                        <div class="col-lg-5"></div>
                                        <div class="col-lg-7">
                                            <input class="form-check-input mt-2" type="checkbox"
                                                   id="ip-edit-product-status"/>
                                            <label for="ip-edit-product-status" class="col-form-label">
                                                Kinh doanh sản phẩm ngay
                                            </label>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-lg-6">
                                    <div class="mb-3 row">
                                        <div class="col-lg-5">
                                            Danh mục sản phẩm
                                        </div>
                                        <div class="col-lg-7">
                                            <select id="ip-edit-product-category" class="form-control select2"
                                                    data-status="edit" onchange="onChangeCategory(this)">
                                                <option th:each="category : ${lstCategories}"
                                                        th:value="${category.categoryId}"
                                                        th:text="${category.categoryName}">
                                                </option>
                                            </select>
                                        </div>
                                    </div>
                                    <div id="product-edit-property"></div>
                                </div>
                            </div>
                        </div>
                        <div class="tab-pane p-3" id="description-product-edit" role="tabpanel">
                            <textarea id="productEditDescription" class="form-control"></textarea>
                        </div>
                        <div class="tab-pane p-3" id="image-product-edit" role="tabpanel">
                            <div class="dropzone mb-3">
                                <div class="fallback">
                                    <input id="ip-edit-product-image" hidden type="file" multiple="multiple">
                                </div>
                                <div class="dz-message needsclick" onclick="onClickChooseImage()">
                                    <div class="mb-3">
                                        <i class="mdi mdi-cloud-upload display-4 text-muted"></i>
                                    </div>
                                    <h4>Nhấn để chọn hình ảnh.</h4>
                                </div>
                            </div>
                            <hr/>
                            <div class="file_upload">
                                <div class="bd-example text-center">
                                    <div id="carouselExampleCaptions" class="carousel slide" data-bs-ride="carousel">
                                        <div class="carousel-indicators text-black-50" id="carousel-indicators">
                                        </div>
                                        <div class="carousel-inner" id="previewUpload">
                                        </div>
                                        <a class="carousel-control-prev " type="button"
                                           data-bs-target="#carouselExampleCaptions"
                                           data-bs-slide="prev">
                                            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                            <span class="visually-hidden">Previous</span>
                                        </a>
                                        <a class="carousel-control-next" type="button"
                                           data-bs-target="#carouselExampleCaptions"
                                           data-bs-slide="next">
                                            <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                            <span class="visually-hidden">Next</span>
                                        </a>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary waves-effect" data-bs-dismiss="modal">Đóng</button>
                    <button type="button" data-id="" class="btn btn-success waves-effect waves-light"
                            id="btn-submit-edit-product" onclick="onClickUpdateProduct(this)">Cập nhật
                    </button>
                </div>
            </div><!-- /.modal-content -->
        </div><!-- /.modal-dialog -->
    </div><!-- /.modal -->

    <div class="modal fade" id="modal-zoom-image" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <img id="img-zoom-image" src=""/>
            </div>
        </div>
    </div>

    <script th:src="@{'/assets/ckeditor/ckeditor.js'}"></script>

    <script>

        let dataImageUploadEdit = [];
        let dataImageUploadAdd = [];
        let sizeImage = 0;

        window.onload = function () {
            $('.modal').hide();
            CKEDITOR.replace('productAddDescription');
            CKEDITOR.replace('productEditDescription');
            $('#ip-edit-product-image').change(function () {
                for (var i = 0, f; (f = this.files[i]); i++) {
                    if (!f.type.match("image.*")) {
                        continue;
                    }
                    var reader = new FileReader();
                    reader.onload = (function (theFile) {
                        return function (e) {
                            dataImageUploadEdit.push(e.target.result)
                            addImagePreview(e.target.result)
                        };
                    })(f);
                    // Read in the image file as a data URL.
                    reader.readAsDataURL(f);
                }
            })
            $('#ip-add-product-image').change(function () {
                for (var i = 0, f; (f = this.files[i]); i++) {
                    if (!f.type.match("image.*")) {
                        continue;
                    }
                    var reader = new FileReader();
                    reader.onload = (function (theFile) {
                        return function (e) {
                            dataImageUploadAdd.push(e.target.result)
                            addImagePreviewAdd(e.target.result)
                        };
                    })(f);
                    // Read in the image file as a data URL.
                    reader.readAsDataURL(f);
                }
            })
        }

        function zoomImageProduct(e) {
            let srcImg = e.src
            console.log(srcImg)
            $('#modal-zoom-image').modal('show');
            let imgZoomImage = document.getElementById('img-zoom-image')
            if (imgZoomImage !== null && imgZoomImage !== undefined) {
                imgZoomImage.src = srcImg
            }
        }

        function onClickChooseImage() {
            $('#ip-edit-product-image').click()
        }

        function onClickChooseImageAdd() {
            $('#ip-add-product-image').click()
        }

        function addImagePreviewAdd(image) {
            let carouselIndicators = document.getElementById('carousel-indicators-add')
            if (sizeImage === 0) {
                carouselIndicators.innerHTML +=
                    '<button type="button" data-bs-target="#carouselExampleCaptionsAdd" data-bs-slide-to="' + sizeImage + '"\n' +
                    'aria-label="Slide ' + sizeImage + '" class="active" aria-current="true"></button>'
            } else {
                carouselIndicators.innerHTML +=
                    '<button type="button" data-bs-target="#carouselExampleCaptionsAdd" data-bs-slide-to="' + sizeImage + '"\n' +
                    'aria-label="Slide ' + sizeImage + '"></button>'
            }
            let divImage = document.createElement('div')
            divImage.className = sizeImage == 0 ? 'carousel-item active' : 'carousel-item'
            divImage.innerHTML = [
                '<img style="height: 600px;" src="',
                image,
                '" title="',
                '"/>'
            ].join("");
            document.getElementById("previewUploadAdd").insertBefore(divImage, null);
            sizeImage += 1;
        }

        function addImagePreview(image) {
            let carouselIndicators = document.getElementById('carousel-indicators')
            if (sizeImage === 0) {
                carouselIndicators.innerHTML +=
                    '<button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="' + sizeImage + '"\n' +
                    'aria-label="Slide ' + sizeImage + '" class="active" aria-current="true"></button>'
            } else {
                carouselIndicators.innerHTML +=
                    '<button type="button" data-bs-target="#carouselExampleCaptions" data-bs-slide-to="' + sizeImage + '"\n' +
                    'aria-label="Slide ' + sizeImage + '"></button>'
            }
            let divImage = document.createElement('div')
            divImage.className = sizeImage == 0 ? 'carousel-item active' : 'carousel-item'
            divImage.innerHTML = [
                '<img style="height: 600px;" src="',
                image,
                '" title="',
                '"/>'
            ].join("");
            document.getElementById("previewUpload").insertBefore(divImage, null);
            sizeImage += 1;
        }

        function onClickUpdateProduct(e) {
            // get element mã sản phẩm
            let getElementProductCode = document.getElementById('ip-edit-product-code');
            // get element tên sản phẩm
            let getElementProductName = document.getElementById('ip-edit-product-name');
            // get element giá bán
            let getElementProductPrice = document.getElementById('ip-edit-product-price');
            // get element thương hiệu
            let getElementProduuctBrand = document.getElementById('ip-edit-product-brand');
            // get element trạng thái kinh doanh
            let getElementProductStatus = document.getElementById('ip-edit-product-status');
            // get element danh mục sản phẩm
            let getElementProductCategory = document.getElementById('ip-edit-product-category');
            // TODO hiển thị hình ảnh sản phẩm
            // get element hình ảnh sản phẩm
            let getElementProductImage = document.getElementById('ip-edit-product-image');
            // get element thuộc tính sản phẩm
            let getElementProductProperty = document.getElementById('product-edit-property');
            // get mô tả chi tiết sản phẩm
            let productDescription = CKEDITOR.instances['productEditDescription'].getData();
            let objectProduct = validateObjectProduct(
                getElementProductCode,
                getElementProductName,
                getElementProductPrice,
                getElementProduuctBrand,
                getElementProductStatus,
                getElementProductCategory,
                productDescription,
                dataImageUploadEdit,
                getElementProductProperty,
            );
            console.log(objectProduct);
            if (objectProduct !== null && objectProduct !== undefined) {
                objectProduct["productId"] = e.dataset.id
                $.ajax({
                    url: '/api/product',
                    method: 'PUT',
                    contentType: 'application/json',
                    data: JSON.stringify(objectProduct),
                    success: function (data) {
                        console.log(data);
                        toastSuccess('Thành công', 'Đã cập nhật sản phẩm')
                        setTimeout(function () {
                            location.reload()
                        }, 2000)
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.log(jqXHR);
                        toastDanger('Lỗi', 'Cập nhật sản phẩm thất bại')
                    }
                })
            }
        }

        function onClickSaveProduct() {
            // get element mã sản phẩm
            let getElementProductCode = document.getElementById('ip-add-product-code');
            // get element tên sản phẩm
            let getElementProductName = document.getElementById('ip-add-product-name');
            // get element giá bán
            let getElementProductPrice = document.getElementById('ip-add-product-price');
            // get element thương hiệu
            let getElementProduuctBrand = document.getElementById('ip-add-product-brand');
            // get element trạng thái kinh doanh
            let getElementProductStatus = document.getElementById('ip-add-product-status');
            // get element danh mục sản phẩm
            let getElementProductCategory = document.getElementById('ip-add-product-category');
            // TODO hiển thị hình ảnh sản phẩm
            // get element hình ảnh sản phẩm
            let getElementProductImage = document.getElementById('ip-add-product-image');
            // get element thuộc tính sản phẩm
            let getElementProductProperty = document.getElementById('product-add-property');
            // get mô tả chi tiết sản phẩm
            let productDescription = CKEDITOR.instances['productAddDescription'].getData();
            let objectProduct = validateObjectProduct(
                getElementProductCode,
                getElementProductName,
                getElementProductPrice,
                getElementProduuctBrand,
                getElementProductStatus,
                getElementProductCategory,
                productDescription,
                dataImageUploadAdd,
                getElementProductProperty,
            );
            console.log(objectProduct);
            if (objectProduct !== null && objectProduct !== undefined) {
                $.ajax({
                    url: '/api/product',
                    method: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify(objectProduct),
                    success: function (data) {
                        toastSuccess('Thành công', 'Đã lưu mới sản phẩm')
                        console.log(data);
                        setTimeout(function () {
                            location.reload()
                        }, 2000)
                    },
                    error: function (jqXHR, textStatus, errorThrown) {
                        console.log(jqXHR);
                        toastDanger('Lỗi', 'Lưu sản phẩm mới thất bại')
                    }
                })
            }
        }

        function validateObjectProduct(
            getElementProductCode,
            getElementProductName,
            getElementProductPrice,
            getElementProduuctBrand,
            getElementProductStatus,
            getElementProductCategory,
            productDescription,
            productImages,
            getElementProductProperty,
        ) {
            let productCode, productName, productPrice, productBrand,
                productStatus, productCategory, productProperties;
            // get mã sản phẩm
            if (getElementProductCode !== null && getElementProductCode !== undefined) {
                productCode = getElementProductCode.value;
            }
            // get tên sản phẩm
            if (getElementProductName !== null && getElementProductName !== undefined) {
                productName = getElementProductName.value;
            }
            // get giá sản bán
            if (getElementProductPrice !== null && getElementProductPrice !== undefined) {
                productPrice = getElementProductPrice.value;
            }
            // get thương hiệu
            if (getElementProduuctBrand !== null && getElementProduuctBrand !== undefined) {
                productBrand = getElementProduuctBrand.value;
            }
            // get trạng thái kinh doanh
            if (getElementProductStatus !== null && getElementProductStatus !== undefined) {
                productStatus = getElementProductStatus.checked;
            }
            // get loại sản phẩm
            if (getElementProductCategory !== null && getElementProductCategory !== undefined) {
                productCategory = getElementProductCategory.value;
            }

            // get thuộc tính sản phẩm
            if (getElementProductProperty !== null && getElementProductProperty !== undefined) {
                productProperties = [];
                let getElementInput = getElementProductProperty.getElementsByTagName('input');
                let getElementSelect = getElementProductProperty.getElementsByTagName('select');
                if (getElementInput !== null && getElementInput !== undefined) {
                    for (let i = 0; i < getElementInput.length; i++) {
                        let value = getElementInput[i].value;
                        if (value !== null && value !== undefined && value !== '') {
                            if (value.length > 50) {
                                console.log('Giá trị thuộc tính không được quá 50 ký tự.');
                                return;
                            }
                            productProperties.push({
                                "propertyId": getElementInput[i].dataset.id,
                                "fixedValueId": null,
                                "inputValue": value,
                            })
                        }
                    }
                }
                if (getElementSelect !== null && getElementSelect !== undefined) {
                    for (let i = 0; i < getElementSelect.length; i++) {
                        let value = getElementInput[i].value;
                        if (value !== null && value !== undefined && value !== '') {
                            productProperties.push({
                                "propertyId": getElementSelect[i].dataset.id,
                                "fixedValueId": value,
                                "inputValue": null,
                            })
                        }
                    }
                }
            }
            // get mô tả chi tiết sản phẩm
            if (productDescription !== null && productDescription !== undefined) {
                productDescription = (productDescription + '').substring(3);
                productDescription = (productDescription + '').substring(0, productDescription.length - 5);
            }

            // validate mã sản phẩm
            if (productCode === null || productCode === undefined || productCode === '') {
                console.log('Vui lòng nhập mã sản phẩm');
                return;
            }
            if (!/^[a-zA-Z0-9\-]+$/.test(productCode)) {
                console.log('Mã sản phẩm không đúng');
                return;
            }
            if (productCode.length < 10 || productCode.length > 50) {
                console.log('Mã sản phẩm chỉ từ 10 đến 50 ký tự');
                return;
            }

            // validate tên sản phẩm
            if (productName === null || productName === undefined || productName === '') {
                console.log('Vui lòng nhập tên sản phẩm');
                return;
            }
            if (productCode.length < 10 || productCode.length > 100) {
                console.log('Tên sản phẩm chỉ từ 10 đến 100 ký tự');
                return;
            }

            // validate giá bán
            if (productPrice === null || productPrice === undefined || productPrice === '') {
                console.log('Vui lòng nhập giá bán đề xuất');
                return;
            }
            if (!/^[0-9]+$/.test(productPrice)) {
                console.log('Giá bán đề xuất không đúng');
                return;
            }
            if (Number(productPrice) < 1) {
                console.log('Giá bán đề xuất phải từ 1đ');
                return;
            }

            // validate thương hiệu
            if (productBrand === null || productBrand === undefined || productBrand === '') {
                console.log('Vui lòng chọn thương hiệu sản xuất của sản phẩm');
                return;
            }

            // validate trạng thái kinh doanh
            if (productStatus === null || productStatus === undefined || productStatus === '') {
                productStatus = false;
            }

            // validate loại sản phẩm & thuộc tính sản phẩm
            if (productCategory === null || productCategory === undefined || productCategory === '') {
                console.log('Vui lòng chọn danh mục sản phẩm');
                return;
            }

            // validate mô tả chi tiết sản phẩm
            if (productDescription === null || productDescription === undefined || productDescription === '') {
                console.log('Vui lòng nhập mô tả chi tiết sản phẩm');
                return;
            }

            // validate hình ảnh sản phẩm
            if (productImages === null || productImages === undefined || productImages.length === 0) {
                console.log('Vui lòng chọn hình ảnh sản phẩm');
                return;
            }

            return {
                "productCode": productCode,
                "productName": productName,
                "productPrice": productPrice,
                "productBrand": productBrand,
                "productStatus": productStatus,
                "productCategory": productCategory,
                "productDescription": productDescription,
                "productImages": productImages,
                "productProperties": productProperties,
            };
        }

        function onChangeCategory(e) {
            // TODO hiển thị danh sách thuộc tính sản phẩm
            let categoryId = e.value
            let status = e.dataset.status
            let url;
            if (status === 'edit') {
                url = '/product/property/edit?category=' + categoryId + '&product=' + e.dataset.id
            } else {
                url = '/product/property/add?category=' + categoryId
            }
            $.ajax({
                url: url,
                method: 'GET',
                success: function (html) {
                    let getElementProductProperty = document.getElementById('product-' + status + '-property');
                    if (getElementProductProperty !== null) {
                        getElementProductProperty.innerHTML = html;
                    }
                }
            })
        }

        function onClickAddProduct() {
            dataImageUploadEdit = [];
        }

        function onClickEditProduct(e) {
            dataImageUploadEdit = [];
            // TODO lấy thông tin sản phẩm
            console.log(e.dataset.id);
            let id = e.dataset.id;
            // get element mã sản phẩm
            let getElementButtonEditProduct = document.getElementById('btn-submit-edit-product');
            if (getElementButtonEditProduct !== null) {
                getElementButtonEditProduct.dataset.id = id
            }
            // get element mã sản phẩm
            let getElementProductCode = document.getElementById('ip-edit-product-code');
            // get element tên sản phẩm
            let getElementProductName = document.getElementById('ip-edit-product-name');
            // get element giá bán
            let getElementProductPrice = document.getElementById('ip-edit-product-price');
            // get element thương hiệu
            let getElementProduuctBrand = document.getElementById('ip-edit-product-brand');
            // get element trạng thái kinh doanh
            let getElementProductStatus = document.getElementById('ip-edit-product-status');
            // get element danh mục sản phẩm
            let getElementProductCategory = document.getElementById('ip-edit-product-category');
            // get element mô tả chi tiết sản phẩm
            let getElementProductDescription = document.getElementById('product-edit-description');
            // TODO hiển thị hình ảnh sản phẩm
            // get element hình ảnh sản phẩm
            let getElementProductImage = document.getElementById('ip-edit-product-image');
            // get element thuộc tính sản phẩm
            let getElementProductProperty = document.getElementById('product-edit-property');
            $.ajax({
                url: '/api/product/' + id,
                method: 'GET',
                success: function (data) {
                    console.log(data)
                    if (getElementProductCode !== null) {
                        getElementProductCode.value = data.productCode;
                    }
                    if (getElementProductName !== null) {
                        getElementProductName.value = data.productName;
                    }
                    if (getElementProductPrice !== null) {
                        getElementProductPrice.value = data.productPrice;
                    }
                    if (getElementProduuctBrand !== null) {
                        getElementProduuctBrand.value = data.productBrand;
                    }
                    if (getElementProductStatus !== null) {
                        getElementProductStatus.checked = data.productStatus === 'ON';
                    }
                    if (data.lstImages !== null && data.lstImages !== undefined) {
                        dataImageUploadEdit = data.lstImages
                        sizeImage = 0;
                        let previewUpload = document.getElementById('previewUpload')
                        let carouselIndicators = document.getElementById('carousel-indicators')
                        if (previewUpload !== null && previewUpload !== undefined) {
                            previewUpload.innerHTML = ''
                            carouselIndicators.innerHTML = ''
                        }
                        for (let i = 0; i < data.lstImages.length; i++) {
                            addImagePreview(data.lstImages[i])
                        }
                    }
                    CKEDITOR.instances['productEditDescription'].setData(data.productDescription)
                    if (getElementProductCategory !== null) {
                        getElementProductCategory.value = data.productCategory;
                        getElementProductCategory.dataset.id = id
                        $.ajax({
                            url: '/product/property/edit?category=' + data.productCategory + '&product=' + id,
                            method: 'GET',
                            success: function (html) {
                                if (getElementProductProperty !== null) {
                                    getElementProductProperty.innerHTML = html;
                                }
                            }
                        })
                    }
                },
                error: function (jqXHR, textStatus, errorThrown) {
                    console.log(jqXHR)
                }
            })
        }

        function onStatusChange(element) {
            const value = $(element).val();
            const tagAll = $('#datatable tbody tr');
            const tag = $('tbody tr td span').filter(function () {
                return $(this).text().includes(value);
            });
            if (value === '') {
                tagAll.show();
            } else {
                tagAll.hide();
                tag.parent().parent().show();
            }
        }

    </script>

</div>
<div layout:fragment="script">
    <script src="/assets/js/dropzone.min.js"></script>
    <script th:src="@{/assets/js/bootstrap-datepicker.min.js}"></script>
    <script src="/assets/js/select2.min.js"></script>
    <script src="/assets/js/form-advanced.init.js"></script>
    <script th:src="@{/toastr/toa.js}"></script>
</div>
</body>
</html>
