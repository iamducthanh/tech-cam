<!doctype html>
<html lang="en"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout" layout:decorate="~{layout/account}"
>

<head>
    <meta charset="utf-8">
    <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/512/809/809052.png">
    <title>Quên mật khẩu</title>
</head>

<body layout:fragment="account">

<!-- Loader -->
<div id="preloader">
    <div id="status">
        <div class="spinner"></div>
    </div>
</div>

<!-- Begin page -->
<div class="accountbg"></div>
<div class="account-pages mt-5 pt-5">
    <div class="container">
        <div class="row justify-content-center">
            <div class="col-md-8 col-lg-5 col-xl-5">
                <!-- Header -->
                <div class="text-center position-relative mb-3">
                    <a href="/">
                        <div><img src="https://cdn-icons-png.flaticon.com/512/809/809052.png" alt="" height="100"></div>
                        <span style="font-size: 40px;color: yellow;">FShop</span>
                    </a>
                </div>

                <!-- Main content -->
                <div class="card mx-4">
                    <div class="card-body">
                        <div class="d-flex p-3">
                            <div class="ms-auto text-end">
                                <h4 class="font-size-18">Quên mật khẩu</h4>
                            </div>
                        </div>
                        <div class="p-3">
                            <div class="alert alert-danger" id="message" th:if="${message != null}" role="alert">
                                [[${message}]]
                            </div>
                            <!--                            <div class="alert alert-danger" id="messageError" style="display:none;" role="alert">-->
                            <!--                                Đã xảy ra lỗi, vui lòng thử lại-->
                            <!--                            </div>-->

                            <div class="form-horizontal">
                                <div class="mb-3">
                                    <label for="useremail" class="form-label">Email</label>
                                    <input type="email" class="form-control" id="useremail" placeholder="Nhập email">
                                </div>
                                <div class="mb-3">
                                    <div class="text-end">
                                        <button class="btn btn-primary w-md waves-effect waves-light" type="submit"
                                                onclick="sendMail()">Gửi
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Footer -->
                <div class="mt-5 text-center position-relative">
                    <p class="text-white-50">Nhớ mật khẩu rồi ư?<a href="/login" class="fw-bold text-white"> Đăng nhập
                        luôn!</a></p>
                    <script>
                        document.write(new Date().getFullYear())
                    </script>
                    © FShop <span class="d-none d-sm-inline-block"> - Work by <i class="mdi mdi-heart text-danger"></i></span>
                </div>
            </div>
        </div>
    </div>
</div>

<div class="modal fade" id="loadingBody"
     style="opacity: 30%; background-color: black; display: none; text-align: center; padding-top: 45vh" tabindex=""
     aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="spinner-border" style="width: 3rem; height: 3rem; color: #c9c6c6" role="status">
        <span class="sr-only"></span>
    </div><!--      </div>-->
</div>

<script>
    function sendMail() {
        document.getElementById('loadingBody').style.display = 'unset'
        $.ajax({
            url: '/api/request-forgot-password?email=' + $('#useremail')[0].value,
            contentType: 'application/json',
            error: function (errors) {
                let message = document.getElementById('message');
                message.innerHTML = errors.responseJSON.vn
                message.className = 'alert alert-danger'
                document.getElementById('loadingBody').style.display = 'none'

            },
            success: function (dataOut) {
                let message = document.getElementById('message');
                message.innerHTML = 'Gửi thành công vui lòng kiểm tra email của bạn!'
                message.className = 'alert alert-success'
                document.getElementById('loadingBody').style.display = 'none'

            },
            type: 'GET'
        });
    }
</script>

</body>
</html>
