<!DOCTYPE HTML>
<html lang="en" xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{layout/weblayout}"
      xmlns:sec="http://www.w3.org/1999/xhtml">
<head>
    <title>Quản lý đơn hàng - TechCam</title>
</head>

<body>
<div layout:fragment="content" class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-lg-2 h-100" id="leftKH">
            <h1 class="heading-page">Danh sách đơn hàng</h1>
            <div class="card" id="formLeft">
                <h3 class="leftTitle" style="margin-top: 10px">Loại đơn hàng</h3>
                <!-- Order Type-->
                <div class="boxLeftC">
                    <select class="typeFilter w-100" multiple style="width: 100%" onchange="onTypeChange(this)">
                        <option value="Online">Online</option>
                        <option value="Tại quầy">Tại quầy</option>
                    </select>
                </div>
                <!-- End Order Type-->
                <div style="border: 1px solid #e3e3e3;margin: 12px 12px;border-radius: 8px;"></div>
                <!-- Order Method-->
                <div>
                    <h3 class="leftTitle">Phương thức thanh toán</h3>
                    <div class="boxLeftC">
                        <div class="form-group form-check">
                            <input class="form-check-input" type="radio" name="order-method" id="orderMethodAll" value="Tất cả" onchange="onOrderMethodChange(this)" checked>
                            <label class="form-check-label" for="orderMethodAll">
                                Tất cả
                            </label>
                        </div>
                        <div class="form-group form-check">
                            <input class="form-check-input" type="radio" name="order-method" id="orderMethodPayment" value="Thẻ" onchange="onOrderMethodChange(this)">
                            <label class="form-check-label" for="orderMethodPayment">
                                <i class="fas fa-credit-card me-2 text-warning"></i>Thẻ
                            </label>
                        </div>
                        <div class="form-group form-check">
                            <input class="form-check-input" type="radio" name="order-method" id="orderMethodCash" value="Tiền mặt" onchange="onOrderMethodChange(this)">
                            <label class="form-check-label" for="orderMethodCash">
                                <i class="fas fa-money-bill-alt me-2 text-success"></i>Tiền mặt
                            </label>
                        </div>
                    </div>
                </div>
                <!-- End Order Method-->
                <div style="border: 1px solid #e3e3e3;margin: 12px 12px;border-radius: 8px;"></div>
                <!-- Status-->
                <div>
                    <h3 class="leftTitle">Trạng thái</h3>
                    <div class="boxLeftC">
                        <div class="form-group form-check">
                            <input class="form-check-input" type="radio" name="status" id="statusAll" value="Tất cả" onchange="onStatusChange(this)" checked>
                            <label class="form-check-label" for="statusAll">
                                Tất cả
                            </label>
                        </div>
                        <div class="form-group form-check">
                            <input class="form-check-input" type="radio" name="status" id="statusUnpaid" value="Chưa thanh toán" onchange="onStatusChange(this)">
                            <label class="form-check-label text-danger" for="statusUnpaid">
                                Chưa thanh toán
                            </label>
                        </div>
                        <div class="form-group form-check">
                            <input class="form-check-input" type="radio" name="status" id="statusPaid" value="Đã thanh toán" onchange="onStatusChange(this)">
                            <label class="form-check-label text-info" for="statusPaid">
                                Đã thanh toán
                            </label>
                        </div>
                        <div class="form-group form-check">
                            <input class="form-check-input" type="radio" name="status" id="statusVerify" value="Chờ xác nhận" onchange="onStatusChange(this)">
                            <label class="form-check-label text-warning" for="statusVerify">
                                Chờ xác nhận
                            </label>
                        </div>
                        <div class="form-group form-check">
                            <input class="form-check-input" type="radio" name="status" id="statusConfirm" value="Chờ xuất hàng" onchange="onStatusChange(this)">
                            <label class="form-check-label text-secondary" for="statusConfirm">
                                Chờ xuất hàng
                            </label>
                        </div>
                        <div class="form-group form-check">
                            <input class="form-check-input" type="radio" name="status" id="statusShipping" value="Đang giao hàng" onchange="onStatusChange(this)">
                            <label class="form-check-label text-primary" for="statusShipping">
                                Đang giao hàng
                            </label>
                        </div>
                        <div class="form-group form-check">
                            <input class="form-check-input" type="radio" name="status" id="statusDone" value="Hoàn thành" onchange="onStatusChange(this)">
                            <label class="form-check-label text-success" for="statusDone">
                                Hoàn thành
                            </label>
                        </div>
                    </div>
                </div>
                <!-- End Status-->
            </div>
        </div>
        <!-- End-Sidebar -->
        <div class="col-lg-10" id="rightKH">
            <div class="row justify-content-end">
                <button type="button" class="btn btn-primary col-auto mb-3 me-2 waves-effect waves-light" data-bs-toggle="modal" data-bs-target=".modal-add-order">
                    <i class="fas fa-plus me-2"></i>Đơn hàng
                </button>
            </div>
            <div class="card">
                <div class="card-body overflow-auto">
                    <table id="datatable"
                           class="table table-striped table-hover table-bordered nowrap dataTable no-footer shadow"
                           style="border-collapse: collapse; border-spacing: 0; width: 100%;">
                        <thead class="text-center align-middle">
                            <th></th>
                            <th>Chức năng</th>
                            <th>Mã hoá đơn</th>
                            <th>Tổng giá tiền</th>
                            <th>Ngày đặt đơn</th>
                            <th>Loại đơn hàng</th>
                            <th>Phương thức<br/>thanh toán</th>
                            <th>Trạng thái</th>
                        </thead>
                        <tbody style="vertical-align: middle;">
                            <tr th:each="order, iterator : ${orders}">
                                <td class="text-end">
                                    <!-- <span th:text="${iterator.index + 1}"></span>-->
                                </td>
                                <td th:switch="${order.getStatus()}" class="text-center">
                                    <i class="col-4 fas fa-info-circle fs-2" style="color: #655be6;" title="Thông tin" onclick="onBtnInfo(this)"></i>
                                    <i th:case="1" class="col-4 fas fa-lock-open fs-2" style="color: green;" title="Khoá tài khoản" onclick="onBtnStatus(this)"></i>
                                    <i th:case="0" class="col-4 fas fa-lock fs-2" style="color: red;" title="Mở khoá tài khoản" onclick="onBtnStatus(this)"></i>
                                </td>
                                <td class="text-center order-id" th:text="${order.getId()}">Mã hoá đơn</td>
                                <td class="text-end order-tax" th:text="${#numbers.formatDecimal(order.getTax(), 0, 'POINT', 0, 'COMMA') + ' đ'}">Tổng giá tiền</td>
                                <td class="text-center" th:text="${#dates.format(order.getCreateDate(), 'dd/MM/yyyy HH:mm:ss')}">Ngày đặt đơn</td>
                                <td class="text-center" th:switch="${order.getOrderType()}">
                                    <span th:case="ONLINE" class="order-type">Online</span>
                                    <span th:case="COUNTER" class="order-type">Tại quầy</span>
                                </td>
                                <td class="text-center" th:switch="${order.getPaymentMethod()}">
                                    <span th:case="PAYMENT" class="order-method">Thẻ</span>
                                    <span th:case="CASH" class="order-method">Tiền mặt</span>
                                </td>
                                <td th:switch="${order.getStatus()}" class="text-center">
                                    <span th:case="UNPAID" class="status badge bg-danger fs-6">Chưa thanh toán</span>
                                    <span th:case="PAID" class="status badge bg-info fs-6">Đã thanh toán</span>
                                    <span th:case="VERIFY" class="status badge bg-warning fs-6">Chờ xác nhận</span>
                                    <span th:case="CONFIRM" class="status badge bg-secondary fs-6">Chờ xuất hàng</span>
                                    <span th:case="SHIPPING" class="status badge bg-primary fs-6">Đang giao hàng</span>
                                    <span th:case="DONE" class="status badge bg-success fs-6">Hoàn thành</span>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Info Order -->
    <div class="modal fade modal-info-order" tabindex="-1" style="display: none;" aria-hidden="true">
        <div class="modal-dialog modal-xl h-100">
            <div class="modal-content" style="height: 90%;">
                <!-- Modal Header-->
                <div class="modal-header">
                    <h5 class="modal-title mt-0 text-center">Chi tiết đơn hàng</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <!-- Modal Body-->
                <div class="modal-body px-4">
                    <!-- Receiver Info-->
                    <div class="row px-3">
                        <!-- Thông tin nhận hàng -->
                        <div class="col-lg-6">
                            <h3 class="fw-bolder text-decoration-underline">Thông tin nhận hàng</h3>
                            <table class="none-border">
                                <tr>
                                    <th><label for="recipientName">Người nhận</label></th>
                                    <td><input class="border-none bg-white" type="text" name="recipientName" id="recipientName" disabled></td>
                                </tr>
                                <tr>
                                    <th><label for="recipientPhone">Số điện thoại</label></th>
                                    <td><input class="border-none bg-white text-primary text-decoration-underline" type="text" name="recipientPhone" id="recipientPhone" disabled></td>
                                </tr>
                                <tr>
                                    <th class="align-top"><label for="recipientAddress">Địa chỉ</label></th>
                                    <td><textarea class="border-none bg-white" name="recipientAddress" id="recipientAddress" rows="3" style="resize: none" disabled></textarea></td>
                                </tr>
                                <tr>
                                    <th><label for="deliveryDate">Ngày giao hàng</label></th>
                                    <td>
                                        <div class="input-daterange input-group" id="datepicker-deliveryDate" data-date-format="dd/mm/yyyy" data-date-autoclose="true" data-provide="datepicker" data-date-container='#datepicker-deliveryDate'>
                                            <input class="form-control border-none bg-white text-start" type="text" name="deliveryDate" id="deliveryDate" onblur="onType(this)" placeholder="dd/MM/yyyy"  disabled>
                                        </div>
                                    </td>
                                </tr>
                            </table>
                        </div>

                        <!-- Thông tin mua hàng -->
                        <div class="col-lg-6">
                            <h3 class="fw-bolder text-decoration-underline">Thông tin mua hàng</h3>
                            <table class="none-border">
                                <tr>
                                    <th><label for="fullName">Người mua</label></th>
                                    <td><input class="border-none bg-white" type="text" name="fullName" id="fullName" disabled></td>
                                </tr>
                                <tr>
                                    <th><label for="phoneNumber">Số điện thoại</label></th>
                                    <td><input class="border-none bg-white text-primary text-decoration-underline" type="text" name="phoneNumber" id="phoneNumber" disabled></td>
                                </tr>
                                <tr>
                                    <th><label for="createDate">Ngày mua</label></th>
                                    <td><span id="createDate"></span></td>
                                </tr>
                                <tr>
                                    <th><label for="fullName">Tổng thanh toán</label></th>
                                    <td><span id="price" class="fw-bolder text-danger"></span></td>
                                </tr>
                            </table>
                        </div>
                    </div>

                    <!-- Split line-->
                    <div style="border: 1px solid #e3e3e3;margin: 25px 0;border-radius: 8px;"></div>

                    <!-- Danh sách mua hàng -->
                    <div>
                        <h3 class="fw-bolder text-center">Danh sách sản phẩm</h3>
                        <table class="border" style="border-collapse: collapse;">
                            <thead style="background: lightgrey;">
                                <th>STT</th>
                                <th>Tên sản phẩm</th>
                                <th>Số lượng <br/> mua</th>
                                <th>Số lượng <br/> tồn kho</th>
                                <th>Trạng thái</th>
                                <th>Khuyến mãi</th>
                                <th>Giá bán</th>
                                <th>Thành tiền</th>
                            </thead>
                            <tbody>
                                <tr>
                                    <td class="text-center">1</td>
                                    <td>SP A</td>
                                    <td class="number">3</td>
                                    <td class="number">5</td>
                                    <td>Còn hàng</td>
                                    <td class="number">0</td>
                                    <td class="number">20.000 đ</td>
                                    <td class="number">60.000 đ</td>
                                </tr>
                                <tr>
                                    <td class="text-center">2</td>
                                    <td>SP B</td>
                                    <td class="number">6</td>
                                    <td class="number">4</td>
                                    <td>Hết hàng</td>
                                    <td class="number">30%</td>
                                    <td class="number">60.000 đ</td>
                                    <td class="number">42.000 đ</td>
                                </tr>
                                <tr>
                                    <td class="text-center">3</td>
                                    <td>SP C</td>
                                    <td class="number">10</td>
                                    <td class="number">7</td>
                                    <td>Hết hàng</td>
                                    <td class="number">30.000 đ</td>
                                    <td class="number">150.000 đ</td>
                                    <td class="number">120.000 đ</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="fas fa-ban me-2"></i>
                        Đóng
                    </button>
                    <button type="button" class="btn btn-success" onclick="onUnlockEdit()">
                        <i class="fas fa-edit me-2"></i>
                        Chỉnh sửa
                    </button>
                    <button type="button" id="btnEdit" class="btn btn-primary waves-effect waves-light">
                        <i class="fas fa-save pe-2"></i>
                        Lưu
                    </button>
                </div>
            </div>
            <!-- /.modal-content -->
        </div>
        <!-- /.modal-dialog -->
    </div>
    <!-- End Modal Info order -->
</div>

<script layout:fragment="script" >

    $(document).ready(function () {
        $('.typeFilter').chosen();

        hoverIconLock();
    });

    function hoverIconLock() {
        $('.fa-lock-open').hover(function () {
            $(this).removeClass('fa-lock-open').addClass('fa-lock').css('color', 'red');
        }, function () {
            $(this).removeClass('fa-lock').addClass('fa-lock-open').css('color', 'green');
        })

        $('.fa-lock').hover(function () {
            $(this).removeClass('fa-lock').addClass('fa-lock-open').css('color', 'green');
        }, function () {
            $(this).removeClass('fa-lock-open').addClass('fa-lock').css('color', 'red');
        })
    }

    $('.arrow').click(function (e) {
        $(this).toggleClass('down');
        $(this).siblings('.expand').toggle();
    })

    $('.check-item').change(function (e) {
        const flag = checkSiblings();

        if (flag) {
            $('#checkAll').prop('checked', true);
        } else {
            $('#checkAll').prop('checked', false);
        }

        function checkSiblings() {
            const checkboxes = $('.check-item').parent().find('input[type="checkbox"]');
            let checkFlag = true;

            checkboxes.each(function () {
                if ($(this).prop("checked") === false) {
                    checkFlag = false;
                }
            });
            return checkFlag;
        }
    });

    // disable mousewheel on a input number field when in focus
    // (to prevent Chromium browsers change the value when scrolling)
    $('form').on('focus', 'input[type=number]', function (e) {
        $(this).on('wheel.disableScroll', function (e) {
            e.preventDefault()
        })
    })
    $('form').on('blur', 'input[type=number]', function (e) {
        $(this).off('wheel.disableScroll')
    })

    // event filter table by status
    function onStatusChange(element) {
        const status = $(element).val();
        const rows = $('table#datatable tr');

        if(status === 'Tất cả') {
            rows.show();
        } else {
            rows.hide();
            rows.find(`.status:contains(${status})`).parent().parent().show();
        }
    }

    // event filter table by orderMethod
    function onOrderMethodChange(element) {
        const orderMethod = $(element).val();
        const rows = $('table#datatable tr');

        if(orderMethod === 'Tất cả') {
            rows.show();
        } else {
            rows.hide();
            rows.find(`.order-method:contains(${orderMethod})`).parent().parent().show();
        }
    }

    // event filter table by orderType
    function onTypeChange() {
        const orderType = $('select.typeFilter').val();
        const rows = $('table#datatable tr');

        if (orderType.length === 0 || orderType.length >=2) {
            rows.show();
        } else {
            rows.hide();
            rows.find(`.order-type:contains(${orderType[0]})`).parent().parent().show();
        }
    }

    // event reset form
    function onUnlockEdit() {
        // Reset form input
        const formInput = $('.modal-info-order').find('.modal-body');
        formInput.removeClass('border-none').attr('disabled', 'false');
    }

    // Submit formAdd
    $('#btnAdd').click(function () {
        let data = {};
        let formData = $('#formAdd').serializeArray();
        $.each(formData, function (i, v) {
            data["" + v.name + ""] = v.value;
        });
        data["dateOfBirth"] = moment(data["dateOfBirth"], 'DD-MM-YYYY').format('YYYY-MM-DD');
        data["username"] = generateUsername(convertViToEn(data["fullName"])) + moment(data["dateOfBirth"], 'YYYY-MM-DD').format('DDMM');

        if(validateForm('add')) {
            addStaff(data);
        } else {
            console.log("validate fail");
        }
    });

    // Event onKeyPress formAdd
    function onType(element) {
        const tag = $(element);
        if(tag.val() === '') {
            tag.addClass('error');
        } else {
            tag.removeClass('error');
        }
    }

    // Validation formAdd
    function validateForm(type) {
        let errorMessage = '';
        const fullName = (type === 'add') ? $('#fullName') : $('#fullName-edit');
        let flag = true;

        if (fullName.val() === '') {
            fullName.addClass('error');
            flag = false;
        }

        if (type === 'add') {
            const email =  $('#email');
            const patternEmail = /^\b[A-Z0-9._%-]+@[A-Z0-9.-]+\.[A-Z]{2,4}\b$/i;
            if (email.val() === '') {
                email.addClass('error');
                flag = false;
            } else if (!patternEmail.test(email.val())) {
                email.addClass('error');
                errorMessage += 'Email không hợp lệ!\n';
                flag = false;
            } else {
                $.ajax({
                    url: `/api/staff/find/email/${email.val()}`,
                    async: false,
                    type: 'GET',
                    contentType: 'application/json',
                    dataType: 'json',
                    success: function (result) {
                        if (result !== 0) {
                            email.addClass('error');
                            errorMessage += 'Email đã được sử dụng!\n';
                            flag = false;
                            console.log(errorMessage);
                        }
                    },
                    error: function (error) {

                    }
                })
            }
        }

        const role = (type === 'add') ? $('#role') : $('#role-edit');
        if (role.val() === null) {
            role.addClass('error');
            flag = false;
        }

        const phoneNumber = (type === 'add') ? $('#phoneNumber') : $('#phoneNumber-edit');
        const patternPhone = /^(84|0[3|5|7|8|9])+([0-9]{8})\b$/i;
        if (phoneNumber.val() === '') {
            phoneNumber.addClass('error');
            flag = false;
        } else if (!patternPhone.test(phoneNumber.val())) {
            phoneNumber.addClass('error');
            errorMessage += 'Số điện thoại không hợp lệ!\n';
            flag = false;
        } else if (type === 'add') {
            $.ajax({
                url: `/api/staff/find/phone/${phoneNumber.val()}`,
                async: false,
                type: 'GET',
                contentType: 'application/json',
                dataType: 'json',
                success: function (result) {
                    if (result !== 0) {
                        phoneNumber.addClass('error');
                        errorMessage += 'Số điện thoại đã được sử dụng!\n';
                        flag = false;
                    }
                },
                error: function (error) {

                }
            })
        }

        const address = (type === 'add') ? $('#address') : $('#address-edit');
        if (address.val() === '') {
            address.addClass('error');
            flag = false;
        }

        const identityNumber = (type === 'add') ? $('#identityNumber') : $('#identityNumber-edit');
        const patternIdentityNumber = /^[0-9]*$/i;
        if (identityNumber.val() === '') {
            identityNumber.addClass('error');
            flag = false;
        } else if (!patternIdentityNumber.test(identityNumber.val())) {
            identityNumber.addClass('error');
            errorMessage += 'Số CMND/CCCD không hợp lệ!\n';
            flag = false;
        }

        if (type === 'edit') {
            const username = $('#staffCode-edit')
            if (username.val() === '') {
                username.addClass('error');
                flag = false;
            }
        }

        if (type === 'edit') {
            const username = $('#username')
            if (username.val() === '') {
                username.addClass('error');
                flag = false;
            }
        }

        if (flag) {
            return true
        }
        errorMessage += 'Mời nhập lại!'
        const Toast = Swal.mixin({
            toast: true,
            position: 'top-end',
            showConfirmButton: false,
            timer: 3000,
            timerProgressBar: true,
            didOpen: (toast) => {
                toast.addEventListener('mouseenter', Swal.stopTimer)
                toast.addEventListener('mouseleave', Swal.resumeTimer)
            }
        })
        Toast.fire({
            icon: 'error',
            title: errorMessage
        })
        return false;
    }

    //API add Staff
    function addStaff(data) {
        $.ajax({
            url: '/api/staff',
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify(data),
            dataType: 'json',
            success: function (result) {
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })
                Toast.fire({
                    icon: 'success',
                    title: 'Thêm thành công'
                }).then(() => window.location.href = "/staff");
            },
            error: function (error) {
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })
                Toast.fire({
                    icon: 'error',
                    title: 'Lỗi khi thêm mới'
                })
            }
        })
    }

    // Submit formEdit
    $('#btnEdit').click(function () {
        let data = {};
        let formData = $('#formEdit').serializeArray();
        $.each(formData, function (i, v) {
            data["" + v.name + ""] = v.value;
        });
        data["dateOfBirth"] = moment(data["dateOfBirth"], 'DD-MM-YYYY').format('YYYY-MM-DD');

        if(validateForm('edit')) {
            editStaff(data);
        } else {
            console.log("validate fail");
        }
    });

    //API edit Staff
    function editStaff(data) {
        $.ajax({
            url: '/api/staff',
            type: 'PUT',
            contentType: 'application/json',
            data: JSON.stringify(data),
            dataType: 'json',
            success: function (result) {
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })
                Toast.fire({
                    icon: 'success',
                    title: 'Cập nhật thành công'
                }).then(() => window.location.href = "/staff");
            },
            error: function (error) {
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                })
                Toast.fire({
                    icon: 'error',
                    title: "Lỗi hệ thống!\nVui lòng thử lại sau"
                })
            }
        })
    }

    let date = '';

    function onBtnInfo (element) {
        const orderId = $(element).parent().parent().find('.order-id').text();

        // Call API get Order info
        $.ajax({
            url: `/api/v1/orders/${orderId}`,
            type: 'GET',
            contentType: 'application/json',
            success: function (result) {
                $('input[name=recipientName]').val(result.recipientName);
                $('input[name=recipientPhone]').val(result.recipientPhone);
                $('input[name=recipientAddress]').val(result.recipientAddress);
                $('input[name=deliveryDate]').val(moment(result.deliveryDate, 'YYYY-MM-DD').format('DD/MM/YYYY'));
                $('#createDate').text(moment(result.orderDate).format('DD/MM/YYYY'));
                $('#price').text(addPoint(`${result.tax - result.totalAmount}`) + ' đ');    // Tổng tiền thanh toán

                // Call API get Order's customer info
                $.ajax({
                    url: `/api/v1/customer/find-by-id/${result.customerId}`,
                    type: 'GET',
                    contentType: 'application/json',
                    success: function (res) {
                        $('input[name=fullName]').val(res.fullName);
                        $('input[name=phoneNumber]').val(res.phoneNumber);

                        $('.modal-info-order').modal('show');
                    },
                    error: function (err) {
                        console.log(err);
                    }
                })
            },
            error: function (error) {
                console.log(error);
            }
        })
    }

    function onBtnStatus (element) {
        const tag = $(element).parent().parent();
        const lock = $(element).hasClass('fa-lock');
        const status = lock ? "0" : "1";
        const length_of_row = $('table#datatable th').length;
        $.ajax({
            url: `/api/staff/status/${tag.find('.check-item').val()}/${status}`,
            type: 'PUT',
            contentType: 'application/json',
            success: function (result) {
                Swal.fire(
                    lock ? 'Đã khoá tài khoản!' : 'Đã mở khoá tài khoản',
                    `Mã nhân viên ${tag.find('.staff-code').text()}`,
                    'success'
                ).then(() => {
                    if (lock) {
                        $(element).removeClass('fa-lock-open').addClass('fa-lock').css('color', 'red');
                        tag.find('.status').text("Ngừng hoạt động");
                        tag.find('.status').removeClass('badge bg-success');
                        tag.find('.status').addClass('badge bg-danger');
                    } else {
                        $(element).removeClass('fa-lock').addClass('fa-lock-open').css('color', 'green');
                        tag.find('.status').text("Đang hoạt động");
                        tag.find('.status').removeClass('badge bg-danger');
                        tag.find('.status').addClass('badge bg-success');
                    }

                    hoverIconLock();
                })
            },
            error: function (error) {
                console.log(error);
                Swal.fire(
                    'Lỗi hệ thống!\nVui lòng thử lại sau!',
                    'error'
                )
            }
        })
    }

    // Script split money string by point
    function addPoint(nStr) {
        nStr += '';
        var x = nStr.split(',');
        var x1 = x[0];
        var x2 = x.length > 1 ? ',' + x[1] : '';
        var rgx = /(\d+)(\d{3})/;
        while (rgx.test(x1)) {
            x1 = x1.replace(rgx, '$1' + '.' + '$2');
        }
        return x1 + x2;
    }

    // JavaScript: Chuyển tiếng Việt có dấu sang không dấu
    function convertViToEn(str, toUpperCase = false) {
        str = str.toLowerCase();
        str = str.replace(/à|á|ạ|ả|ã|â|ầ|ấ|ậ|ẩ|ẫ|ă|ằ|ắ|ặ|ẳ|ẵ/g, "a");
        str = str.replace(/è|é|ẹ|ẻ|ẽ|ê|ề|ế|ệ|ể|ễ/g, "e");
        str = str.replace(/ì|í|ị|ỉ|ĩ/g, "i");
        str = str.replace(/ò|ó|ọ|ỏ|õ|ô|ồ|ố|ộ|ổ|ỗ|ơ|ờ|ớ|ợ|ở|ỡ/g, "o");
        str = str.replace(/ù|ú|ụ|ủ|ũ|ư|ừ|ứ|ự|ử|ữ/g, "u");
        str = str.replace(/ỳ|ý|ỵ|ỷ|ỹ/g, "y");
        str = str.replace(/đ/g, "d");
        // Some system encode vietnamese combining accent as individual utf-8 characters
        str = str.replace(/\u0300|\u0301|\u0303|\u0309|\u0323/g, ""); // Huyền sắc hỏi ngã nặng
        str = str.replace(/\u02C6|\u0306|\u031B/g, ""); // Â, Ê, Ă, Ơ, Ư

        return toUpperCase ? str.toUpperCase() : str;
    }

    /**
     * Generate Username from fullname
     */
    function generateUsername(str) {
        //Split to array of words
        let arr = str.split(' ');
        let username = arr[arr.length - 1];

        // Remove firstname from array of fullname
        arr.pop();

        // Get the First Letter of each String
        arr.forEach(e => username+=e.charAt(0));
        if (arr.length === 1) {
            return arr[0];
        }
        return username;
    }

    // On change Avatar
    function onChangeAvatar(type) {
        const allowedFiles = ["jpeg", "png"];
        const file = $(`#img-file${type === 'edit' ? '-edit' : ''}`).prop('files')[0];
        if (file) {
            let found = false;
            allowedFiles.forEach(function (extension) {
                if (file.type.match('image/' + extension)) {
                    found = true;
                }
            });
            if (found) {
                // Preview image
                $(`#img-temp${type === 'edit' ? '-edit' : ''}`).attr('src', URL.createObjectURL(file));

                // Adding value to input form
                const reader = new FileReader();
                reader.readAsDataURL(file);
                reader.onloadend = function() {
                    $(`#img-base64${type === 'edit' ? '-edit' : ''}`).val(reader.result);
                }
            } else {
                const Toast = Swal.mixin({
                    toast: true,
                    position: 'top-end',
                    showConfirmButton: false,
                    timer: 3000,
                    timerProgressBar: true,
                    didOpen: (toast) => {
                        toast.addEventListener('mouseenter', Swal.stopTimer)
                        toast.addEventListener('mouseleave', Swal.resumeTimer)
                    }
                });
                Toast.fire({
                    icon: 'error',
                    title: 'Ảnh không hợp lệ!'
                });
            }
        }
    }
</script>

</body>
</html>